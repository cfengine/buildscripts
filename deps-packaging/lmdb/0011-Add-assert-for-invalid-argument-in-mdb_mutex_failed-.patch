From 3b0357e2871f524eaa7a2eabd08e0c545c8204b6 Mon Sep 17 00:00:00 2001
From: Craig Comstock <craig.comstock@northern.tech>
Date: Fri, 23 Jun 2023 09:53:51 -0500
Subject: [PATCH 11/13] Add assert for invalid argument in mdb_mutex_failed()
 called by mdb_txn_begin()

---
 libraries/liblmdb/mdb.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/libraries/liblmdb/mdb.c b/libraries/liblmdb/mdb.c
index 4ef334ce6..6e381672e 100644
--- a/libraries/liblmdb/mdb.c
+++ b/libraries/liblmdb/mdb.c
@@ -1,3 +1,4 @@
+#include <assert.h>
 /** @file mdb.c
  *	@brief Lightning memory-mapped database library
  *
@@ -10290,6 +10291,7 @@ mdb_reader_check0(MDB_env *env, int rlocked, int *dead)
 static int ESECT
 mdb_mutex_failed(MDB_env *env, mdb_mutexref_t mutex, int rc)
 {
+	assert(rc != EINVAL); // ENT-9198 invalid argument when opening cf_lock.lmdb
 	int rlocked, rc2;
 	MDB_meta *meta;
 
-- 
2.25.1

